<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title></title>
    <link rel="stylesheet" href="../css/bootstrap.min.css">
    <link href="../css/style.css" rel="stylesheet" type="text/css"/>
    <link href="../css/select.css" rel="stylesheet" type="text/css"/>
    <script type="text/javascript" src="../js/jquery.js"></script>
    <script type="text/javascript" src="../js/jquery.min.js"></script>
    <script type="text/javascript" src="../js/jquery.idTabs.min.js"></script>
    <script type="text/javascript" src="../js/select-ui.min.js"></script>
    <script type="text/javascript" src="../editor/kindeditor.js"></script>
    <script src="../js/bootstrap.min.js"></script>
    <script type="text/javascript">
        $(document).ready(function (e) {
            $(".select1").uedSelect({
                width: 345
            });
            $(".select2").uedSelect({
                width: 167
            });
            $(".select3").uedSelect({
                width: 200
            });
            $(".select4").uedSelect({
                width: 60
            });
        });
    </script>
</head>


<body>

<div class="place">
    <span>位置：</span>
    <ul class="placeul">
        <li><a href="#">用户管理</a></li>
        <li><a href="../admin/teacherManage.html">教师管理</a></li>
    </ul>
    <span style="padding-left: 250px;color: red" id="errormsg"></span>
</div>
<div class="rightinfo">



</div>
<div class="rightinfo">
    <!--模糊搜索-->
    <div class="tools">
        <ul class="seachform" style="" >
            <li><label>条数</label>
                <div class="vocation">
                    <select class="select4" name="department" id="number" onchange="numberChange()">
                        <option value="5">5</option>
                        <option value="10" selected="selected">10</option>
                        <option value="15">15</option>
                    </select>
                </div>
            </li>
        <ul class="toolbar">
            <li class="click"><a onclick="" href="#" class="tablelink" data-toggle="modal"
                                 data-target="#myModal_add"><span><img src="../images/t01.png"/></span>添加教师</a>
                <label>  </label>
            </li>
            <label> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </label>
        </ul>
        <form id="condition_form">
            <ul class="seachform" style="" >
                <li><label>姓名查询</label><input id="name" name="coursename" type="text" class="scinput"/></li>
                 <li><label>院系查询</label>
                    <div class="vocation">
                        <select class="select3" name="department" id="department">
                            <option value="" selected="selected">--请选择--</option>
                            <option>全部</option>
                            <option>其他</option>
                        </select>
                    </div>
                </li>
                <li><label>&nbsp;</label><input name="" id="search_btn" type="button" class="scbtn" value="搜索"/></li>
                <li><label>&nbsp;</label><input  type="button" class="scbtn"  onclick="fanhui()" value="返回全部"/></li>
                <li><input  type="button" class="scbtn" style="width: 89px" onclick="tableToExcel()" value="全部教师导出"/></a></li>

            </ul>
            <!--        <ul class="toolbar">-->
            <!--            <li class="click"><span><img src="images/t01.png" /></span>添加</li>-->
            <!--        </ul>-->
        </form>
        </ul>
    </div>


    <table class="tablelist">
        <thead>
        <tr>
            <th style="width:3%">编号</th>
            <th style="width: 8%">账号</th>
            <th style="width: 8%">密码</th>
            <th style="width: 7%">姓名</th>
            <th style="width: 7%">性别</th>
            <th style="width: 5%">年龄</th>
            <th style="width: 10%">Phone</th>
            <th style="width: 14%">Email</th>
            <th style="width: 12%">院系</th>
            <th style="width: 9%">操作</th>
        </tr>
        </thead>
        <tbody id="teacher_list">
<!--        <tr>-->
<!--            <td>1</td>-->
<!--            <td>Java程序设计</td>-->
<!--            <td>匡杰</td>-->
<!--            <td>星期一【上午12节】周三【下午56节】</td>-->
<!--            <td>Java</td>-->
<!--            <td>信息工程学院</td>-->
<!--            <td>5</td>-->
<!--            <td><a href="#" class="tablelink"><img src="../images/t02.png" style="height: 18px;width: 18px;"/>&nbsp;&nbsp;&nbsp;</a>-->
<!--                <a href="#" class="tablelink"> <img src="../images/t03.png" style="height: 18px;width: 18px;"/></a></td>-->
<!--        </tr>-->
        </tbody>
    </table>

    <div class="pagin">
        <div class="message" id="data_msg">共<i class="blue">1256</i>条记录，【1/19页】</div>
        <ul class="paginList" id="nav_list">
            <li class="paginItem"><a href="javascript:;"><span class="pagepre"></span></a></li>
            <li class="paginItem"><a href="javascript:;">首页</a></li>
            <li class="paginItem"><a href="javascript:;" style="width: 50px">上一页</a></li>
            <li class="paginItem"><a href="javascript:;" style="width: 50px">下一页</a></li>
            <li class="paginItem"><a href="javascript:;">尾页</a></li>
            <li class="paginItem"><a href="javascript:;"><span class="pagenxt"></span></a></li>
        </ul>
    </div>

    <!--模态框-->
    <!-- 模态框（Modal） 添加教师触发的模态框-->
    <div class="modal fade" id="myModal_add" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
         aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                        &times;
                    </button>
                    <h4 class="modal-title" id="myModalLabel">
                        添加教师
                    </h4>
                </div>
                <div class="modal-body">
                    <div class="formbody">
                        <form id="addForm">
                        <ul class="forminfo">
                            <li><label>账号：</label><input id="account_add" name="account" type="text" class="dfinput"
                                                         value=""/></li>
                            <li><label>密码：</label><input id="password_add" name="password" type="text" class="dfinput"
                                                         value=""/></li>
                            <li><label>姓名：</label><input id="name_add" name="name" type="text" class="dfinput"
                                                         value=""/></li>
                            <li><label>性别：</label><input id="sex_add" id="sex" name="" type="text"
                                                         class="dfinput" value="" /></li>
                            <li><label>年龄：</label><input id="age_add" name="age" type="text" class="dfinput"
                                                         value=""/></li>
                            <li><label>Phone：</label><input id="phone_add" name="phone" type="text" class="dfinput"
                                                            value=""/></li>
                            <li><label>Email：</label><input id="email_add" name="email" type="text" class="dfinput"
                                                            value=""/></li>
                            <li><label>院系：</label><input id="department_add" name="department" type="text" class="dfinput"
                                                         value=""/></li>
                            <li style="text-align: center"> <span id="error_msg" style="color: red"></span></li>
                            <li><input type="hidden" value="" name="id" id="teacher_id_add"/></li>
                        </ul>
                        </form>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭
                    </button>
                    <button type="button" class="btn btn-primary" onclick="add_Teacher()">
                        确认添加
                    </button>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal -->
    </div>
     <!--模态框-->
    <!-- 模态框（Modal） 修改教师触发的模态框-->
    <div class="modal fade" id="myModal_update" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
         aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                        &times;
                    </button>
                    <h4 class="modal-title" id="myModalLabel_update">
                        修改教师信息
                    </h4>
                </div>
                <div class="modal-body">
                    <div class="formbody">
                        <ul class="forminfo">
                            <li><label>账号：</label><input id="account_update" name="" type="text" class="dfinput"
                                                           value=""/></li>
                            <li><label>密码：</label><input id="password_update" name="" type="text" class="dfinput"
                                                           value=""/></li>
                            <li><label>姓名：</label><input id="name_update" name="" type="text" class="dfinput"
                                                         value=""/></li>
                            <li><label>性别：</label><input id="sex_update" id="" name="" type="text"
                                                           class="dfinput" value="" /></li>
                            <li><label>年龄：</label><input id="age_update" name="" type="text" class="dfinput"
                                                         value=""/></li>
                            <li><label>Phone：</label><input id="phone_update" name="" type="text" class="dfinput"
                                                         value=""/></li>
                            <li><label>Email：</label><input id="email_update" name="" type="text" class="dfinput"
                                                         value=""/></li>
                            <li><label>院系：</label><input id="department_update" name="" type="text" class="dfinput"
                                                         value=""/></li>
                            <li><input type="hidden" value="" id="teacher_id_update"/></li>
                        </ul>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭
                    </button>
                    <button type="button" class="btn btn-primary" id="updateCourse" onclick="updateTeacher()">
                        提交更改
                    </button>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal -->
    </div>

</div>
<script>
    //获取URL产的值的方法
    function getParameter(variable) {
        var query = window.location.search.substring(1);
        var vars = query.split("&");
        for (var i = 0; i < vars.length; i++) {
            var pair = vars[i].split("=");
            if (pair[0] == variable) {
                return pair[1];
            }
        }
        return (false);
    }
    //每页显示数据
    var size = $("#number").val();
    //刷新页面
    function numberChange(){
        size = $("#number").val();
        findTeacherAll(1);
    }
    //主体
    $(function () {
        //初始化当前页
        var pageNo=1;
        //加载数据,初始数据，不安条件搜索的数据
        findTeacherAll(pageNo);
        getKindAll();
        //点击搜索按钮触发事件
        $("#search_btn").click(function () {
            findTeacherByCondition(pageNo);
        })
    });

    //获取初始数据
    function findTeacherAll(pageNo=1) {
        $.get("../teacher/getTeacherAll.do", {size, pageNo}, function (data) {
            if (data.flag) {
                //总页数
                var pageSum=data.maxPage;
                if (pageNo<=0){pageNo=1}
                if (pageNo>pageSum){pageNo=pageSum}
                $("#data_msg").empty();
                $("#data_msg").append(`共<i class="blue">${data.count}</i>条记录，【${pageNo}/${pageSum}页】`);
                //课程数据处理展示
                //清空列表
                $("#teacher_list").empty();
                //取出课程数据
                var list = data.data;
                //定义一个变量来用于编号
                var a = 0;
                for (var i = 0; i < list.length; i++) {
                    //编号循环
                    a = a + 1;
                    var teacher = list[i];
                    $("#teacher_list").append(`
                            <tr>
                            <td>${a}</td>
                            <td>${teacher.account}</td>
                            <td>${teacher.password}</td>
                            <td>${teacher.name}</td>
                            <td>${teacher.sex}</td>
                            <td>${teacher.age}</td>
                            <td>${teacher.phone }</td>
                            <td>${teacher.email}</td>
                            <td>${teacher.department}</td>
                            <td>
                            <a href="#" class="tablelink" onclick="getTeacherById(${teacher.id})"><img src="../images/t02.png" style="height: 18px;width: 18px;" title="修改信息" data-toggle="modal" data-target="#myModal_update"/>&nbsp;&nbsp;</a>
                             <a href="#" class="tablelink" onclick="deleteTeacher(${teacher.id})"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="../images/t03.png" style="height: 18px;width: 18px;" title="删除"/></a>
                    </td>
                           `);
                }

                    //换页符
                    $("#nav_list").empty();
                    $("#nav_list").append(`
                            <li class="paginItem"><a href="javascript:;"><span class="pagepre"></span></a></li>
                            <li class="paginItem"><a href="javascript:findTeacherAll(1);">首页</a></li>
                            <li class="paginItem"><a href="javascript:findTeacherAll(${pageNo - 1});" style="width: 50px">上一页</a></li>
                            <li class="paginItem"><a href="javascript:findTeacherAll(${pageNo + 1});" style="width: 50px">下一页</a></li>
                            <li class="paginItem"><a href="javascript:findTeacherAll(${pageSum});">尾页</a></li>
                            <li class="paginItem"><a href="javascript:;"><span class="pagenxt"></span></a></li>
                            `);

            }
        }, "json");
    }


    //按条件查询数据(有条件时执行此方法)
    function findTeacherByCondition(pageNo) {
        //获取搜索的条件
        var name = $("#name").val();
        var department = $("#department").val();
        if (name == "" && department == "") {
            $("#errormsg").html("请输入查询条件！");
            findTeacherAll(1);
            setTimeout(function () {
                $("#errormsg").html("");
            }, 2000);
            return false;
        } else {
            $("#errormsg").html("");
        }
        $.get("../teacher/getTeacherAll.do", {
            name,
            department,
            size,
            pageNo
        }, function (data) {
            if (data.flag) {
                var count_condition = data.count;
                if (count_condition == 0) {
                    $("#errormsg").html("查询结果为空！");
                    setTimeout(function () {
                        $("#errormsg").html("");
                    }, 2000);
                    findTeacherAll(1);
                    return false;
                }

                //总页数
                var pageSum = data.maxPage;
                if (pageNo<=0){pageNo=1}
                if (pageNo>pageSum){pageNo=pageSum}
                $("#data_msg").empty();
                $("#data_msg").append(`共<i class="blue">${data.count}</i>条记录，【${pageNo}/${pageSum}页】`);
            }
            //清空列表
            $("#teacher_list").empty();
            //取出课程数据
            var list = data.data;
            //定义一个变量来用于编号
            var a = 0;
            for (var i = 0; i < list.length; i++) {
                //编号循环
                a = a + 1;
                var teacher = list[i];
                $("#teacher_list").append(`
                            <tr>
                            <td>${a}</td>
                            <td>${teacher.account}</td>
                            <td>${teacher.password}</td>
                            <td>${teacher.name}</td>
                            <td>${teacher.sex}</td>
                            <td>${teacher.age}</td>
                            <td>${teacher.phone }</td>
                            <td>${teacher.email}</td>
                            <td>${teacher.department}</td>
                            <td>
                            <a href="#" class="tablelink" onclick="getTeacherById(${teacher.id})"><img src="../images/t02.png" style="height: 18px;width: 18px;" title="修改信息" data-toggle="modal" data-target="#myModal_update"/>&nbsp;&nbsp;</a>
                             <a href="#" class="tablelink" onclick="deleteTeacher(${teacher.id})"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="../images/t03.png" style="height: 18px;width: 18px;" title="删除"/></a>
                    </td>
                           `);
            }
            //换页符
            $("#nav_list").empty();
            $("#nav_list").append(`
                            <li class="paginItem"><a href="javascript:;"><span class="pagepre"></span></a></li>
                            <li class="paginItem"><a href="javascript:findTeacherByCondition(1);">首页</a></li>
                            <li class="paginItem"><a href="javascript:findTeacherByCondition(${pageNo - 1});" style="width: 50px">上一页</a></li>
                            <li class="paginItem"><a href="javascript:findTeacherByCondition(${pageNo + 1});" style="width: 50px">下一页</a></li>
                            <li class="paginItem"><a href="javascript:findTeacherByCondition(${pageSum});">尾页</a></li>
                            <li class="paginItem"><a href="javascript:;"><span class="pagenxt"></span></a></li>
                            `);
        }, "json")

    }


    //查询全部的类别信息,设置下拉列表
    function getKindAll() {
        $.get("../teacher/getKindAll.do", function (data) {
            //院系
            var departmentAll = data.data;
            $("#department").empty();
            $("#department").append(`<option value="">--请选择--</option>`);
            for (var i = 0; i < departmentAll.length; i++) {
                $("#department").append(`<option value="${departmentAll[i]}">${departmentAll[i]}</option>`);
            }
        }, "json")
    }

    //添加教师的方法
    function add_Teacher() {
        var name = $("#name_add").val();
        var account = $("#account_add").val();
        var password = $("#password_add").val();
        var department = $("#department_add").val();
        var sex =$("#sex_add").val();
        var age =$("#age_add").val();
        var phone =$("#phone_add").val();
        var email = $("#email_add").val();
        if (name=="" || account=="" || password=="" || department==""){
            $("#error_msg").html("请输入完整信息!");
            setTimeout(function () {
                $("#error_msg").html("");
            }, 2000);
            return false;
        }
        $.ajax({
            type:"get",
            url:"../teacher/addTeacherAdmin.do",
            data:{name,account,password,department,sex,age,phone,email},
            dataType:"json",
            contentType:"application/json",
            success:function (data) {
                if (data.flag){
                    confirm(data.msg);
                    location.href="../admin/teacherManage.html";
                } else {
                    if (data.data==-1) {
                        $("#error_msg").html(data.msg);
                        setTimeout(function () {
                            $("#error_msg").html("");
                        }, 2000);
                    }
                    if (data.data==0) {
                        $("#error_msg").html(data.msg);
                        setTimeout(function () {
                            $("#error_msg").html("");
                        }, 2000);
                    }

                }
            }

        })
    }
    //删除学生的方法
    function deleteTeacher(id) {
        if (confirm("确定要删除吗？")) {
            $.ajax({
                type: "get",
                url: "../teacher/deleteTeacher.do",
                data: {id},
                contentType: "application/json;charset=utf-8",
                success: function (data) {
                    location.href = "../admin/teacherManage.html";
                }
            });
        }
    }

    //根据学生id获取学生信息，将其显示在修改的模态框中(修改学会第一步)
    function getTeacherById(tid) {
        $.get("../teacher/getTeacherById.do", {tid}, function (data) {
            if (data.flag) {
                $("#account_update").val(data.data[0].account);
                $("#password_update").val(data.data[0].password);
                $("#name_update").val(data.data[0].name);
                $("#sex_update").val(data.data[0].sex);
                $("#age_update").val(data.data[0].age);
                $("#phone_update").val(data.data[0].phone);
                $("#email_update").val(data.data[0].email);
                $("#department_update").val(data.data[0].department);
                $("#teacher_id_update").val(tid);
            }
        }, "json")
    }
    //修改第二步，提交进行修改
    function updateTeacher() {
        var name = $("#name_update").val();
        var account = $("#account_update").val();
        var password = $("#password_update").val();
        var department = $("#department_update").val();
        var sex =$("#sex_update").val();
        var age =$("#age_update").val();
        var phone =$("#phone_update").val();
        var email = $("#email_update").val();
        var id = $("#teacher_id_update").val();
        $.ajax({
            type:"get",
            url:"../teacher/updateTeacherAdmin.do",
            data:{name,account,password,department,sex,age,phone,email,id},
            dataType:"json",
            contentType:"application/json",
            success:function (data) {
                if (data.flag){
                    confirm(data.msg);
                    location.href="../admin/teacherManage.html";
                } else {
                    confirm(data.msg);
                }
            }

        })



    }

    //--------数据校验-----
    //校验性别，只能为男或女
    function checkSex() {
        //拿到
        var sex = $("#sex_add").val();
        //进行校验
        var flag ;
        if(sex=='男' || sex=='女'){
            flag=true;
        }else {
            flag=false;
        }
        //根据结果修改表单样式
        if (flag) {
            $("#sex_add").css("border", "");
        } else {
            $("#sex_add").css("border", "1px solid red");
            $("#sex_add").val("请输入'男'或'女'！");
            setTimeout(function () {
                $("#sex_add").val("");
                $("#sex_add").css("border", "");
            }, 1000);

        }
        return flag;
    };   //绑定离焦事件
    $("#sex_add").blur(checkSex);
    //校验年龄，只能为数字
    function checkAge() {
        //拿到
        var age = $("#age_add").val();
        //一个正则表达式
        var check_age = /^[0-9]*$/;
        //进行校验
        var flag = check_age.test(age);
        //根据结果修改表单样式
        if (flag) {
            $("#age_add").css("border", "");
        } else {
            $("#age_add").css("border", "1px solid red")
            $("#age_add").val("请输入正确格式！");
            setTimeout(function () {
                $("#age_add").val("");
                $("#age_add").css("border", "");
            }, 1000);
        }
        return flag;
    };//绑定离焦事件
    $("#age_add").blur(checkAge);
    //校验手机号，只能为数字
    function checkPhone() {
        //拿到
        var phone = $("#phone_add").val();
        //一个正则表达式
        var check_phone = /^[0-9]*$/;
        //进行校验
        var flag = check_phone.test(phone);
        //根据结果修改表单样式
        if (flag) {
            $("#phone_add").css("border", "");
        } else {
            $("#phone_add").css("border", "1px solid red")
            $("#phone_add").val("请输入数字！");
            setTimeout(function () {
                $("#phone_add").val("");
                $("#phone_add").css("border", "");
            }, 1000);
        }
        return flag;
    };//绑定离焦事件
    $("#phone_add").blur(checkPhone);
    //校验密码
    function checkpassword() {
        //拿到
        var password = $("#password_add").val();
        //一个正则表达式
        var check_password = /^\w{6,20}$/;
        //进行校验
        var flag = check_password.test(password);
        //根据结果修改表单样式
        if (flag) {
            $("#password_add").css("border", "");
        } else {
            $("#password_add").css("border", "1px solid red")
            $("#password_add").val("密码格式错误，请重新输入6-20位数字和字母！");
            setTimeout(function () {
                $("#password_add").val("");
                $("#password_add").css("border", "");
            }, 1000);
        }
        return flag;
    };//绑定离焦事件
    $("#password_add").blur(checkpassword);
    //校验邮箱
    function checkemail() {
        //拿到
        var email = $("#email_add").val();
        //一个正则表达式
        var check_email = /^\w+@\w+\.\w+$/;
        //进行校验
        var flag = check_email.test(email);
        //根据结果修改表单样式
        if (flag) {
            $("#email_add").css("border", "");
        } else {
            $("#email_add").css("border", "1px solid red")
            $("#email_add").val("Email格式错误，请重新输入！");
            setTimeout(function () {
                $("#email_add").val("");
                $("#email_add").css("border", "");
            }, 1000);
        }
        return flag;
    };//绑定离焦事件
    $("#email_add").blur(checkemail);
    //--------数据校验-----


    function fanhui() {
        location.href="teacherManage.html";
    }


    //数据导出
    function tableToExcel() {
        //获取数据
        $.get("../teacher/getAllTeacher.do",function (data) {
            const jsonData=data;
            //列标题，逗号隔开，每一个逗号就是隔开一个单元格
            let str = `姓名,性别,年龄,电话,邮箱,院系\n`;
            //增加\t为了不让表格显示科学计数法或者其他格式
            for(let i = 0 ; i < jsonData.length ; i++ ){
                for(let item in jsonData[i]){
                    str+=`${jsonData[i][item] + '\t'},`;
                }
                str+='\n';
            }
            //encodeURIComponent解决中文乱码
            let uri = 'data:text/csv;charset=utf-8,\ufeff' + encodeURIComponent(str);
            //通过创建a标签实现
            let link = document.createElement("a");
            link.href = uri;
            //对下载的文件命名
            link.download =  "全部教师数据表.csv";
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        },"json")
    }

</script>

</body>
</html>
